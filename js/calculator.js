if("undefined"!=typeof TL2CALC)throw new Error("Namespace Conflict: variable TL2CALC is already defined.");var TL2CALC=function(){var e="berserker",n=[[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0]],t=132,i=15;return{setPoint:function(e,a,s){s=Number(s),isNaN(s)&&(s=0),s=s>i?i:s,s=0>s?0:s;var l=this.getPointsSpent();s=s-n[e][a]+l>t?t-l+n[e][a]:s,n[e][a]=s,TL2CALC.Mailman.publish("pointChange",e,a,s)},getPoint:function(e,t){return n[e][t]},getPointsInTree:function(e){for(var t=0,i=0,a=n[e].length;a>i;i++)t+=n[e][i];return t},getPointsSpent:function(){for(var e=0,t=0,i=n.length;i>t;t++)e+=this.getPointsInTree(t);return e},setPlayer:function(n){e=String(n)},getPlayer:function(){return e}}}();TL2CALC.Mailman=function(){var e=[];return{subscribe:function(n,t,i){if("string"!=typeof n)throw new Error("You must provide a topic as a string!");"undefined"==typeof e[n]&&(e[n]=[]),e[n].push({context:t,callback:i})},unsubscribe:function(n,t,i){for(var a=0;a<e[n].length;a++)e[n][a].callback===i&&e[n][a].context==t&&(e[n].splice(a,1),a--)},publish:function(n){var t=[].slice.call(arguments,1);if("undefined"==typeof e[n])return!0;for(var i=0,a=e[n].length;a>i;i++)e[n][i].callback.apply(e[n][i].context,t)}}}(),TL2CALC.SkillsetLoader=function(){var e=function(e){},n=function(e){200===e.target.status&&TL2CALC.Mailman.publish("skillsetLoaded",JSON.parse(e.target.responseText))},t=function(e){},i=function(i){TL2CALC.setPlayer(i);var a=new XMLHttpRequest;a.addEventListener("progress",e),a.addEventListener("load",n),a.addEventListener("error",t),a.addEventListener("abort",t),a.open("GET","data/"+i+".json",!0),a.send()};TL2CALC.Mailman.subscribe("playerChange",this,i)}(),TL2CALC.SkillDescriptor=function(){var e,n=function(n){e=n},t=function(n,t){TL2CALC.Mailman.publish("skillDescriptionResponse",e.skillset.tree[n].skill[t],t)};TL2CALC.Mailman.subscribe("skillsetLoaded",this,n),TL2CALC.Mailman.subscribe("skillRequest",this,t)}(),TL2CALC.UrlManager=function(){var e=function(e){return decodeURI(window.location.search.replace(new RegExp("^(?:.*[&\\?]"+encodeURI(e).replace(/[\.\+\*]/g,"\\$&")+"(?:\\=([^&]*))?)?.*$","i"),"$1"))},n=function(){var i=e("class");(null==i||""==i)&&(i=TL2CALC.getPlayer()),TL2CALC.Mailman.unsubscribe("uiReady",this,n),TL2CALC.Mailman.subscribe("skillsetLoaded",this,t),TL2CALC.Mailman.publish("playerChange",i)},t=function(){var n=e("points").split("");if(null==n||""==n)n=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];else if(n.length<30)for(var a=n.length;30>a;a++)n[a]=0;for(var a=0;3>a;a++)for(var s=0;10>s;s++)TL2CALC.setPoint(a,s,i(n[10*a+s]));TL2CALC.Mailman.unsubscribe("skillsetLoaded",this,t),TL2CALC.Mailman.subscribe("playerChange",this,l)},i=function(e){return e=parseInt(e,16),isNaN(e)?0:e},a=function(e){return e=parseInt(e,10),isNaN(e)?0:e.toString(16)},s=function(){for(var e="",n=0;30>n;n++)e+=a(TL2CALC.getPoint(Math.floor(n/10),n-10*Math.floor(n/10)));return e},l=function(){var e=[location.protocol,"//",location.host,location.pathname].join("");e+="?class="+TL2CALC.getPlayer()+"&points="+s(),history.replaceState({calc:"points"},"TL2 Calculator Saved Build",e),TL2CALC.Mailman.publish("linkChange",e)};TL2CALC.Mailman.subscribe("uiReady",this,n),TL2CALC.Mailman.subscribe("pointChange",this,l)}(),TL2CALC.UI={},TL2CALC.UI.Player=function(e){var n=function(){var n=e.getAttribute("data-player");TL2CALC.Mailman.publish("playerChange",n)},t=function(n){var t=e.getAttribute("data-player");t==n?e.className.match(new RegExp("(?:^|\\s)active(?!\\S)","g"))||(e.className+=" active"):e.className=e.className.replace(new RegExp("(?:^|\\s)active(?!\\S)","g"),"")};TL2CALC.Mailman.subscribe("playerChange",this,t),e.addEventListener("click",n)},TL2CALC.UI.Tab=function(e,n){var t=function(e){TL2CALC.Mailman.publish("treeChange",n)},i=function(t){e.getElementsByClassName("name")[0].innerHTML=t.skillset.tree[n].name},a=function(t){n==t?e.className.match(new RegExp("(?:^|\\s)active(?!\\S)","g"))||(e.className+=" active"):e.className=e.className.replace(new RegExp("(?:^|\\s)active(?!\\S)","g"),"")};TL2CALC.Mailman.subscribe("treeChange",this,a),TL2CALC.Mailman.subscribe("skillsetLoaded",this,i),e.addEventListener("click",t)},TL2CALC.UI.Point=function(e,n){var t=function(t){n==t&&(e.innerHTML=TL2CALC.getPointsInTree(t))};TL2CALC.Mailman.subscribe("pointChange",this,t)},TL2CALC.UI.Tree=function(e,n){var t=function(t){n==t?e.className.match(new RegExp("(?:^|\\s)active(?!\\S)","g"))||(e.className+=" active"):e.className=e.className.replace(new RegExp("(?:^|\\s)active(?!\\S)","g"),"")};TL2CALC.Mailman.subscribe("treeChange",this,t)},TL2CALC.UI.SkillButton=function(e,n,t){var i=function(i){var a=e.getAttribute("data-effect");switch(a){case"clear":TL2CALC.setPoint(n,t,0);break;case"minus":TL2CALC.setPoint(n,t,TL2CALC.getPoint(n,t)-1);break;case"plus":TL2CALC.setPoint(n,t,TL2CALC.getPoint(n,t)+1)}};e.addEventListener("click",i)},TL2CALC.UI.SkillName=function(e,n,t){var i=function(i){e.innerHTML=i.skillset.tree[n].skill[t].name};TL2CALC.Mailman.subscribe("skillsetLoaded",this,i)},TL2CALC.UI.SkillLevel=function(e,n,t){var i=function(i,a,s){n==i&&t==a&&(e.innerHTML=s)};TL2CALC.Mailman.subscribe("pointChange",this,i)},TL2CALC.UI.SkillIcon=function(e,n,t){var i={},a=function(e){i.inactive={xPos:e.skillset.tree[n].skill[t].icons.inactive.xPos,yPos:e.skillset.tree[n].skill[t].icons.inactive.yPos},i.active={xPos:e.skillset.tree[n].skill[t].icons.active.xPos,yPos:e.skillset.tree[n].skill[t].icons.active.yPos},s(n,t,TL2CALC.getPoint(n,t))},s=function(a,s,l){n==a&&t==s&&(l>0?(e.style.backgroundPosition=-i.active.xPos+"px "+-i.active.yPos+"px",e.className.match(new RegExp("(?:^|\\s)active(?!\\S)","g"))||(e.className+=" active")):(e.style.backgroundPosition=-i.inactive.xPos+"px "+-i.inactive.yPos+"px",e.className=e.className.replace(new RegExp("(?:^|\\s)active(?!\\S)","g"),"")))},l=function(e){TL2CALC.Mailman.publish("skillHover",n,t)},r=function(e){TL2CALC.Mailman.publish("skillHoverOut","1")};TL2CALC.Mailman.subscribe("skillsetLoaded",this,a),TL2CALC.Mailman.subscribe("pointChange",this,s),e.addEventListener("mouseover",l),e.addEventListener("mouseout",r)},TL2CALC.UI.SkillDescription=function(e){var n=function(e,n){TL2CALC.Mailman.publish("skillRequest",e,n)},t=function(n,t){t>5?e.className.match(new RegExp("(?:^|\\s)alternate(?!\\S)","g"))||(e.className+="alternate"):e.className=e.className.replace(new RegExp("(?:^|\\s)alternate(?!\\S)","g"),""),e.style.left="0",e.getElementsByClassName("description-name")[0].innerHTML=n.name,e.getElementsByClassName("description-content")[0].innerHTML=n.description,"undefined"==typeof n.tiers?(e.getElementsByClassName("tier-1")[0].innerHTML="",e.getElementsByClassName("tier-2")[0].innerHTML="",e.getElementsByClassName("tier-3")[0].innerHTML=""):(e.getElementsByClassName("tier-1")[0].innerHTML=n.tiers.tier[0],e.getElementsByClassName("tier-2")[0].innerHTML=n.tiers.tier[1],e.getElementsByClassName("tier-3")[0].innerHTML=n.tiers.tier[2])},i=function(){e.style.left="100%"};TL2CALC.Mailman.subscribe("skillDescriptionResponse",this,t),TL2CALC.Mailman.subscribe("skillHover",this,n),TL2CALC.Mailman.subscribe("skillHoverOut",this,i)},TL2CALC.UI.ShareLink=function(e){var n=function(n){e.innerHTML=n};TL2CALC.Mailman.subscribe("linkChange",this,n)},window.onload=function(){for(var e,n,t=[],i=[],a=[],s=[],l=[],r=[],o=[],c=[],L=document.getElementsByClassName("player"),C=0,u=L.length;u>C;C++)t[C]=new TL2CALC.UI.Player(L[C]);for(var m=document.getElementsByClassName("tab"),C=0,u=m.length;u>C;C++)o[C]=new TL2CALC.UI.Tab(m[C],C),r[C]=new TL2CALC.UI.Point(m[C].getElementsByClassName("point")[0],C);for(var T=document.getElementsByClassName("tree"),C=0,u=T.length;u>C;C++){c[C]=new TL2CALC.UI.Tree(T[C],C);var g=T[C].getElementsByClassName("skill");i[C]=[],s[C]=[],a[C]=[],l[C]=[];for(var f=0,p=g.length;p>f;f++){s[C][f]=new TL2CALC.UI.SkillName(g[f].getElementsByClassName("skill-name")[0],C,f),a[C][f]=new TL2CALC.UI.SkillIcon(g[f].getElementsByClassName("skill-icon")[0],C,f),l[C][f]=new TL2CALC.UI.SkillLevel(g[f].getElementsByClassName("skill-level")[0],C,f);var v=g[f].getElementsByClassName("skill-button");i[C][f]=[];for(var h=0,b=v.length;b>h;h++)i[C][f][h]=new TL2CALC.UI.SkillButton(v[h],C,f)}}n=new TL2CALC.UI.SkillDescription(document.getElementById("description")),e=new TL2CALC.UI.ShareLink(document.getElementById("share-link")),TL2CALC.Mailman.publish("uiReady")};