var Tl2calc={};Tl2calc.Core=function(){var e="berserker",a=132,t=15,l=3,n=10,i=[];return function(){for(var e=0;l>e;e++){i[e]=[];for(var a=0;n>a;a++)i[e][a]=0}}(),{getTrees:function(){return l},getSkills:function(){return n},getCharacter:function(){return e},setCharacter:function(a){e=a,Tl2calc.Mailman.publish("characterChanged",a)},getSpentInTree:function(e){for(var a=0,t=0;n>t;t++)a+=i[e][t];return a},getSpent:function(){for(var e=0,a=0;l>a;a++)e+=this.getSpentInTree(a);return e},getPoint:function(e,a){return i[e][a]},setPoint:function(e,l,n){"number"!=typeof n&&(n=0),n=n>t?t:n,n=0>n?0:n;var c=this.getSpent();n=n-i[e][l]+c>a?a-c+i[e][l]:n,i[e][l]=n,Tl2calc.Mailman.publish("pointChanged"),Tl2calc.Mailman.publish("pointChanged:"+e),Tl2calc.Mailman.publish("pointChanged:"+e+","+l,n)},getPoints:function(){return i},getSkillMax:function(){return t}}}(),Tl2calc.Mailman=function(){var e=[];return{subscribe:function(a,t,l,n){var n=n||5;if(n=n>10?10:n,n=0>n?0:n,"string"!=typeof a)throw new Error("You must provide a topic as a string!");"undefined"==typeof e[a]&&(e[a]=[]),"undefined"==typeof e[a]["priority:"+n]&&(e[a]["priority:"+n]=[]),e[a]["priority:"+n].push({context:t,callback:l})},unsubscribe:function(a,t,l){for(var n=0;10>=n;n++)if("undefined"!=typeof e[a]["priority:"+n])for(var i=0;i<e[a]["priority:"+n].length;i++)e[a]["priority:"+n][i].callback===l&&e[a]["priority:"+n][i].context==t&&(e[a]["priority:"+n].splice(i,1),i--)},publish:function(a){var t=[].slice.call(arguments,1);if("undefined"==typeof e[a])return!0;for(var l=0;10>=l;l++)if("undefined"!=typeof e[a]["priority:"+l])for(var n=0,i=e[a]["priority:"+l].length;i>n;n++)e[a]["priority:"+l][n].callback.apply(e[a]["priority:"+l][n].context,t)}}}(),Tl2calc.SkillsetFetcher=function(){var e=function(e){},a=function(e){200===e.target.status&&(data=JSON.parse(e.target.responseText),Tl2calc.Mailman.publish("skillsetLoaded",data.skillset))},t=function(e){},l=function(l){var n=new XMLHttpRequest;n.addEventListener("progress",e),n.addEventListener("load",a),n.addEventListener("error",t),n.addEventListener("abort",t),n.overrideMimeType("application/json"),n.open("GET","characters/"+l+"/skillset.json",!0),n.send()};Tl2calc.Mailman.subscribe("characterChanged",this,l)}(),Tl2calc.SkillsetDescriptor=function(){var e,a=function(a){e=a,Tl2calc.Mailman.subscribe("describeProperty",this,t)},t=function(a,t){{var l,t=t||{},n=t.tree||0,i=t.skill||0;t.tier||0,t.status||"active"}switch(a){case"treeName":l=e.trees[n].name,Tl2calc.Mailman.publish("propertyDescribed:treeName,"+n,l);break;case"skillName":l=e.trees[n].skills[i].name,Tl2calc.Mailman.publish("propertyDescribed:skillName,"+n+","+i,l);break;case"skillIcon":l=e.trees[n].skills[i].icon,Tl2calc.Mailman.publish("propertyDescribed:skillIcon,"+n+","+i,l);break;case"skillAll":l=e.trees[n].skills[i],Tl2calc.Mailman.publish("propertyDescribed:skillAll",l)}};Tl2calc.Mailman.subscribe("skillsetLoaded",this,a,0)}(),Tl2calc.BuildManager=function(){var e=function(e){return decodeURI(window.location.search.replace(new RegExp("^(?:.*[&\\?]"+encodeURI(e).replace(/[\.\+\*]/g,"\\$&")+"(?:\\=([^&]*))?)?.*$","i"),"$1"))},a=function(e){return parseInt(e,16)||0},t=function(e){return parseInt(e,10)?e.toString(16):0},l=function(){for(var t=Tl2calc.Core.getTrees(),l=Tl2calc.Core.getSkills(),n=e("class")||Tl2calc.Core.getCharacter(),i=e("points").split(""),c=0,s=t*l;s>c;c++)i[c]=a(i[c]);Tl2calc.Core.setCharacter(n);for(var c=0;t>c;c++)for(var r=0;l>r;r++)Tl2calc.Core.setPoint(c,r,i[10*c+r])},n=function(){for(var e=Tl2calc.Core.getTrees(),a=Tl2calc.Core.getSkills(),l=(Tl2calc.Core.getCharacter(),Tl2calc.Core.getPoints()),n="",i=0;e>i;i++)for(var c=0;a>c;c++)n+=t(l[i][c]);var s=[location.protocol,"//",location.host,location.pathname].join("")+"?class="+Tl2calc.Core.getCharacter()+"&points="+n;history.replaceState({calc:"points"},"TL2 Calculator Saved Build",s),Tl2calc.Mailman.publish("buildEncoded",s)};Tl2calc.Mailman.subscribe("characterChanged",this,n),Tl2calc.Mailman.subscribe("pointChanged",this,n),Tl2calc.Mailman.subscribe("windowLoaded",this,l,10)}(),Tl2calc.Portraits=function(){var e=function(){for(var e=document.getElementsByClassName("portrait"),t=0,l=e.length;l>t;t++)new a(e[t],e[t].getAttribute("data-character"))},a=function(e,a){var t=function(){Tl2calc.Core.setCharacter(a)},l=function(t){t===a?(e.className=e.className.replace(new RegExp("(?:^|\\s)inactive(?!\\S)","g"),""),e.className.match(new RegExp("(?:^|\\s)active(?!\\S)","g"))||(e.className+=" active")):(e.className=e.className.replace(new RegExp("(?:^|\\s)active(?!\\S)","g"),""),e.className.match(new RegExp("(?:^|\\s)inactive(?!\\S)","g"))||(e.className+=" inactive"))};e.addEventListener("click",t),Tl2calc.Mailman.subscribe("characterChanged",this,l)};Tl2calc.Mailman.subscribe("windowLoaded",this,e)}(),Tl2calc.Tabs=function(){var e=function(){for(var e=document.getElementsByClassName("tab"),t=0,l=e.length;l>t;t++)new a(e[t],t)},a=function(e,a){var t=e.getElementsByClassName("tab-name")[0],l=function(e){Tl2calc.Mailman.publish("showTree",a)},n=function(t){t===a?e.className.match(new RegExp("(?:^|\\s)active(?!\\S)","g"))||(e.className+=" active"):e.className=e.className.replace(new RegExp("(?:^|\\s)active(?!\\S)","g"),"")},i=function(e){t.innerHTML=e},c=function(){Tl2calc.Mailman.subscribe("propertyDescribed:treeName,"+a,this,i),Tl2calc.Mailman.publish("describeProperty","treeName",{tree:a})};e.addEventListener("click",l),Tl2calc.Mailman.subscribe("showTree",this,n),Tl2calc.Mailman.subscribe("skillsetLoaded",this,c,10)};Tl2calc.Mailman.subscribe("windowLoaded",this,e)}(),Tl2calc.TabPoints=function(){var e=function(){for(var e=document.getElementsByClassName("tab-points"),t=0,l=e.length;l>t;t++)new a(e[t],t)},a=function(e,a){var t=function(){e.innerHTML=Tl2calc.Core.getSpentInTree(a)};Tl2calc.Mailman.subscribe("pointChanged:"+a,this,t)};Tl2calc.Mailman.subscribe("windowLoaded",this,e)}(),Tl2calc.Trees=function(){var e=function(){for(var e=document.getElementsByClassName("tree"),t=0,l=e.length;l>t;t++)new a(e[t],t)},a=function(e,a){var t=function(t){t===a?e.className.match(new RegExp("(?:^|\\s)active(?!\\S)","g"))||(e.className+=" active"):e.className=e.className.replace(new RegExp("(?:^|\\s)active(?!\\S)","g"),"")};Tl2calc.Mailman.subscribe("showTree",this,t)};Tl2calc.Mailman.subscribe("windowLoaded",this,e)}(),Tl2calc.SkillBars=function(){var e,a,t=Tl2calc.Core.getSkillMax(),l=function(){var l=document.getElementsByClassName("skill-bar"),i=Tl2calc.Core.getSkills();e=l[0].offsetWidth/(t+2),a=l[0].getElementsByClassName("skill-bar-knob")[0].offsetWidth;for(var c=0,s=l.length;s>c;c++){var r=Math.floor(c/i);new n(l[c],r,c-i*r)}},n=function(l,n,i){var c=l.getElementsByClassName("skill-bar-knob")[0],s=l.getElementsByClassName("skill-bar-fill")[0],r=function(t){c.style.left=e*t+"px",s.style.width=e*t+a/2+"px"},o=function(a){var c=Math.floor((a.clientX-l.getBoundingClientRect().left)/e);c=c>t?t:c,c=0>c?0:c,Tl2calc.Core.setPoint(n,i,c)},u=function(e){o(e),window.addEventListener("mousemove",o)},m=function(e){window.removeEventListener("mousemove",o)};l.addEventListener("mousedown",u),window.addEventListener("mouseup",m),Tl2calc.Mailman.subscribe("pointChanged:"+n+","+i,this,r)};Tl2calc.Mailman.subscribe("windowLoaded",this,l)}(),Tl2calc.SkillLevels=function(){var e=Tl2calc.Core.getSkillMax(),a=function(){for(var e=document.getElementsByClassName("skill-level"),a=Tl2calc.Core.getSkills(),l=0,n=e.length;n>l;l++){var i=Math.floor(l/a);new t(e[l],i,l-a*i)}},t=function(a,t,l){var n=function(e){a.value=e},i=function(a){if(""!=a.target.value){var n=parseInt(a.target.value,10)||0;n=n>e?e:n,n=0>n?0:n,Tl2calc.Core.setPoint(t,l,n)}},c=function(e){""==e.target.value&&n(Tl2calc.Core.getPoint(t,l))};a.addEventListener("keyup",i),a.addEventListener("change",c),Tl2calc.Mailman.subscribe("pointChanged:"+t+","+l,this,n)};Tl2calc.Mailman.subscribe("windowLoaded",this,a,10)}(),Tl2calc.SkillNames=function(){var e=function(){for(var e=document.getElementsByClassName("skill-name"),t=Tl2calc.Core.getSkills(),l=0,n=e.length;n>l;l++){var i=Math.floor(l/t);new a(e[l],i,l-t*i)}},a=function(e,a,t){var l=function(a){e.innerHTML=a};Tl2calc.Mailman.subscribe("propertyDescribed:skillName,"+a+","+t,this,l),Tl2calc.Mailman.publish("describeProperty","skillName",{tree:a,skill:t})};Tl2calc.Mailman.subscribe("skillsetLoaded",this,e,10)}(),Tl2calc.SkillIcons=function(){var e=function(){for(var e=document.getElementsByClassName("skill-icon"),t=Tl2calc.Core.getSkills(),l=0,n=e.length;n>l;l++){var i=Math.floor(l/t);new a(e[l],i,l-t*i)}},a=function(e,a,t){var l=function(l){l>0?e.className=e.className.replace(new RegExp("(?:^|\\s)inactive(?!\\S)","g"),""):e.className.match(new RegExp("(?:^|\\s)inactive(?!\\S)","g"))||(e.className+=" inactive"),e.style.backgroundImage="url('characters/"+Tl2calc.Core.getCharacter()+"/icons.jpg')",e.style.backgroundPosition=64*-t+"px "+64*-a+"px"},n=function(){l(Tl2calc.Core.getPoint(a,t))},i=function(e){Tl2calc.Mailman.publish("showDescription",a,t)},c=function(e){Tl2calc.Mailman.publish("hideDescription")};e.addEventListener("mouseover",i),e.addEventListener("mouseout",c),Tl2calc.Mailman.subscribe("pointChanged:"+a+","+t,this,l),Tl2calc.Mailman.subscribe("skillsetLoaded",this,n,10)};Tl2calc.Mailman.subscribe("windowLoaded",this,e)}(),Tl2calc.SkillDescription=function(){var e,a=document.getElementsByClassName("description")[0],t=a.getElementsByClassName("description-name")[0],l=a.getElementsByClassName("description-content")[0],n=a.getElementsByClassName("description-tier"),i=function(){a.style.left="-100%"},c=function(t,l){e=Tl2calc.Core.getPoint(t,l),a.style.top=l>5?"0":"50%",a.style.left=0,Tl2calc.Mailman.publish("describeProperty","skillAll",{tree:t,skill:l})},s=function(a){var t=!1;switch(a){case 0:e>=5&&(t=!0);break;case 1:e>=10&&(t=!0);break;case 2:e>=15&&(t=!0)}t?n[a].className.match(new RegExp("(?:^|\\s)active(?!\\S)","g"))||(n[a].className+=" active"):n[a].className=n[a].className.replace(new RegExp("(?:^|\\s)active(?!\\S)","g"),"")},r=function(e){t.innerHTML=e.name,l.innerHTML=e.description;for(var a=0;3>a;a++)n[a].innerHTML="undefined"==typeof e.tiers?"":e.tiers[a],s(a)};Tl2calc.Mailman.subscribe("propertyDescribed:skillAll",this,r),Tl2calc.Mailman.subscribe("showDescription",this,c),Tl2calc.Mailman.subscribe("hideDescription",this,i)}(),Tl2calc.ShareLink=function(){var e=document.getElementsByClassName("share")[0].getElementsByClassName("link")[0],a=function(a){e.innerHTML=a};Tl2calc.Mailman.subscribe("buildEncoded",this,a)}(),window.onload=function(){Tl2calc.Mailman.publish("windowLoaded")};