if("undefined"!=typeof TL2CALC)throw new Error("Namespace Conflict: variable TL2CALC is already defined.");var TL2CALC=function(){var e="berserker",n=[[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0]],t=132,a=15;return{setPoint:function(e,i,s){s=Number(s),isNaN(s)&&(s=0),s=s>a?a:s,s=0>s?0:s;var l=this.getPointsSpent();s=s-n[e][i]+l>t?t-l+n[e][i]:s,n[e][i]=s,TL2CALC.Mailman.publish("pointChange",e,i,s)},getPoint:function(e,t){return n[e][t]},getPointsInTree:function(e){for(var t=0,a=0,i=n[e].length;i>a;a++)t+=n[e][a];return t},getPointsSpent:function(){for(var e=0,t=0,a=n.length;a>t;t++)e+=this.getPointsInTree(t);return e},setPlayer:function(n){e=String(n)},getPlayer:function(){return e}}}();TL2CALC.Mailman=function(){var e=[];return{subscribe:function(n,t,a){if("string"!=typeof n)throw new Error("You must provide a topic as a string!");"undefined"==typeof e[n]&&(e[n]=[]),e[n].push({context:t,callback:a})},unsubscribe:function(n,t,a){for(var i=0;i<e[n].length;i++)e[n][i].callback===a&&e[n][i].context==t&&(e[n].splice(i,1),i--)},publish:function(n){var t=[].slice.call(arguments,1);if("undefined"==typeof e[n])return!0;for(var a=0,i=e[n].length;i>a;a++)e[n][a].callback.apply(e[n][a].context,t)}}}(),TL2CALC.SkillsetLoader=function(){var e=function(e){},n=function(e){200===e.target.status&&TL2CALC.Mailman.publish("skillsetLoaded",JSON.parse(e.target.responseText))},t=function(e){},a=function(a){TL2CALC.setPlayer(a);var i=new XMLHttpRequest;i.addEventListener("progress",e),i.addEventListener("load",n),i.addEventListener("error",t),i.addEventListener("abort",t),i.open("GET","data/"+a+".json",!0),i.send()};TL2CALC.Mailman.subscribe("playerChange",this,a)}(),TL2CALC.UrlManager=function(){var e=function(e){return decodeURI(window.location.search.replace(new RegExp("^(?:.*[&\\?]"+encodeURI(e).replace(/[\.\+\*]/g,"\\$&")+"(?:\\=([^&]*))?)?.*$","i"),"$1"))},n=function(){var a=e("class");(null==a||""==a)&&(a=TL2CALC.getPlayer()),TL2CALC.Mailman.unsubscribe("uiReady",this,n),TL2CALC.Mailman.subscribe("skillsetLoaded",this,t),TL2CALC.Mailman.publish("playerChange",a)},t=function(){var n=e("points").split("");if(null==n||""==n)n=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];else if(n.length<30)for(var i=n.length;30>i;i++)n[i]=0;for(var i=0;3>i;i++)for(var s=0;10>s;s++)TL2CALC.setPoint(i,s,a(n[10*i+s]));TL2CALC.Mailman.unsubscribe("skillsetLoaded",this,t),TL2CALC.Mailman.subscribe("playerChange",this,l)},a=function(e){return e=parseInt(e,16),isNaN(e)?0:e},i=function(e){return e=parseInt(e,10),isNaN(e)?0:e.toString(16)},s=function(){for(var e="",n=0;30>n;n++)e+=i(TL2CALC.getPoint(Math.floor(n/10),n-10*Math.floor(n/10)));return e},l=function(){var e=[location.protocol,"//",location.host,location.pathname].join("");e+="?class="+TL2CALC.getPlayer()+"&points="+s(),history.replaceState({calc:"points"},"TL2 Calculator Saved Build",e),TL2CALC.Mailman.publish("linkChange",e)};TL2CALC.Mailman.subscribe("uiReady",this,n),TL2CALC.Mailman.subscribe("pointChange",this,l)}(),TL2CALC.UI={},TL2CALC.UI.Player=function(e){var n=function(){var n=e.getAttribute("data-player");TL2CALC.Mailman.publish("playerChange",n)},t=function(n){var t=e.getAttribute("data-player");t==n?e.className.match(new RegExp("(?:^|\\s)active(?!\\S)","g"))||(e.className+=" active"):e.className=e.className.replace(new RegExp("(?:^|\\s)active(?!\\S)","g"),"")};TL2CALC.Mailman.subscribe("playerChange",this,t),e.addEventListener("click",n)},TL2CALC.UI.Tab=function(e,n){var t=function(e){TL2CALC.Mailman.publish("treeChange",n)},a=function(t){e.getElementsByClassName("name")[0].innerHTML=t.skillset.tree[n].name},i=function(t){n==t?e.className.match(new RegExp("(?:^|\\s)active(?!\\S)","g"))||(e.className+=" active"):e.className=e.className.replace(new RegExp("(?:^|\\s)active(?!\\S)","g"),"")};TL2CALC.Mailman.subscribe("treeChange",this,i),TL2CALC.Mailman.subscribe("skillsetLoaded",this,a),e.addEventListener("click",t)},TL2CALC.UI.Point=function(e,n){var t=function(t){n==t&&(e.innerHTML=TL2CALC.getPointsInTree(t))};TL2CALC.Mailman.subscribe("pointChange",this,t)},TL2CALC.UI.Tree=function(e,n){var t=function(t){n==t?e.className.match(new RegExp("(?:^|\\s)active(?!\\S)","g"))||(e.className+=" active"):e.className=e.className.replace(new RegExp("(?:^|\\s)active(?!\\S)","g"),"")};TL2CALC.Mailman.subscribe("treeChange",this,t)},TL2CALC.UI.SkillButton=function(e,n,t){var a=function(a){var i=e.getAttribute("data-effect");switch(i){case"clear":TL2CALC.setPoint(n,t,0);break;case"minus":TL2CALC.setPoint(n,t,TL2CALC.getPoint(n,t)-1);break;case"plus":TL2CALC.setPoint(n,t,TL2CALC.getPoint(n,t)+1)}};e.addEventListener("click",a)},TL2CALC.UI.SkillName=function(e,n,t){var a=function(a){e.innerHTML=a.skillset.tree[n].skill[t].name};TL2CALC.Mailman.subscribe("skillsetLoaded",this,a)},TL2CALC.UI.SkillLevel=function(e,n,t){var a=function(a,i,s){n==a&&t==i&&(e.innerHTML=s)};TL2CALC.Mailman.subscribe("pointChange",this,a)},TL2CALC.UI.SkillIcon=function(e,n,t){var a={},i=function(e){a.inactive={xPos:e.skillset.tree[n].skill[t].icons.inactive.xPos,yPos:e.skillset.tree[n].skill[t].icons.inactive.yPos},a.active={xPos:e.skillset.tree[n].skill[t].icons.active.xPos,yPos:e.skillset.tree[n].skill[t].icons.active.yPos},s(n,t,TL2CALC.getPoint(n,t))},s=function(i,s,l){n==i&&t==s&&(l>0?(e.style.backgroundPosition=-a.active.xPos+"px "+-a.active.yPos+"px",e.className.match(new RegExp("(?:^|\\s)active(?!\\S)","g"))||(e.className+=" active")):(e.style.backgroundPosition=-a.inactive.xPos+"px "+-a.inactive.yPos+"px",e.className=e.className.replace(new RegExp("(?:^|\\s)active(?!\\S)","g"),"")))};TL2CALC.Mailman.subscribe("skillsetLoaded",this,i),TL2CALC.Mailman.subscribe("pointChange",this,s)},TL2CALC.UI.ShareLink=function(e){var n=function(n){e.innerHTML=n};TL2CALC.Mailman.subscribe("linkChange",this,n)},window.onload=function(){for(var e,n=[],t=[],a=[],i=[],s=[],l=[],r=[],o=[],c=document.getElementsByClassName("player"),C=0,L=c.length;L>C;C++)n[C]=new TL2CALC.UI.Player(c[C]);for(var u=document.getElementsByClassName("tab"),C=0,L=u.length;L>C;C++)r[C]=new TL2CALC.UI.Tab(u[C],C),l[C]=new TL2CALC.UI.Point(u[C].getElementsByClassName("point")[0],C);for(var g=document.getElementsByClassName("tree"),C=0,L=g.length;L>C;C++){o[C]=new TL2CALC.UI.Tree(g[C],C);var m=g[C].getElementsByClassName("skill");t[C]=[],i[C]=[],a[C]=[],s[C]=[];for(var f=0,T=m.length;T>f;f++){i[C][f]=new TL2CALC.UI.SkillName(m[f].getElementsByClassName("skill-name")[0],C,f),a[C][f]=new TL2CALC.UI.SkillIcon(m[f].getElementsByClassName("skill-icon")[0],C,f),s[C][f]=new TL2CALC.UI.SkillLevel(m[f].getElementsByClassName("skill-level")[0],C,f);var v=m[f].getElementsByClassName("skill-button");t[C][f]=[];for(var h=0,p=v.length;p>h;h++)t[C][f][h]=new TL2CALC.UI.SkillButton(v[h],C,f)}}e=new TL2CALC.UI.ShareLink(document.getElementById("share-link")),TL2CALC.Mailman.publish("uiReady")};