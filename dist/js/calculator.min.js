if("undefined"!=typeof TL2CALC)throw new Error("Namespace Conflict: variable TL2CALC is already defined.");var TL2CALC=function(){var a="berserker",b=[[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0]],c=132,d=15;return{setPoint:function(a,e,f){f=Number(f),isNaN(f)&&(f=0),f=f>d?d:f,f=0>f?0:f;var g=this.getPointsSpent();f=f-b[a][e]+g>c?c-g+b[a][e]:f,b[a][e]=f,TL2CALC.Mailman.publish("pointChange",a,e,f)},getPoint:function(a,c){return b[a][c]},getPointsInTree:function(a){for(var c=0,d=0,e=b[a].length;e>d;d++)c+=b[a][d];return c},getPointsSpent:function(){for(var a=0,c=0,d=b.length;d>c;c++)a+=this.getPointsInTree(c);return a},setPlayer:function(b){a=String(b)},getPlayer:function(){return a}}}();TL2CALC.Mailman=function(){var a=[];return{subscribe:function(b,c,d){if("string"!=typeof b)throw new Error("You must provide a topic as a string!");"undefined"==typeof a[b]&&(a[b]=[]),a[b].push({context:c,callback:d})},unsubscribe:function(b,c,d){for(var e=0;e<a[b].length;e++)a[b][e].callback===d&&a[b][e].context==c&&(a[b].splice(e,1),e--)},publish:function(b){var c=[].slice.call(arguments,1);if("undefined"==typeof a[b])return!0;for(var d=0,e=a[b].length;e>d;d++)a[b][d].callback.apply(a[b][d].context,c)}}}(),TL2CALC.SkillsetLoader=function(){var a=function(){},b=function(a){200===a.target.status&&TL2CALC.Mailman.publish("skillsetLoaded",JSON.parse(a.target.responseText))},c=function(){},d=function(d){TL2CALC.setPlayer(d);var e=new XMLHttpRequest;e.addEventListener("progress",a),e.addEventListener("load",b),e.addEventListener("error",c),e.addEventListener("abort",c),e.open("GET","data/"+d+".min.json",!0),e.send()};TL2CALC.Mailman.subscribe("playerChange",this,d)}(),TL2CALC.UrlManager=function(){var a=function(a){return decodeURI(window.location.search.replace(new RegExp("^(?:.*[&\\?]"+encodeURI(a).replace(/[\.\+\*]/g,"\\$&")+"(?:\\=([^&]*))?)?.*$","i"),"$1"))},b=function(){var d=a("class");(null==d||""==d)&&(d=TL2CALC.getPlayer()),TL2CALC.Mailman.unsubscribe("uiReady",this,b),TL2CALC.Mailman.subscribe("skillsetLoaded",this,c),TL2CALC.Mailman.publish("playerChange",d)},c=function(){var b=a("points").split("");if(null==b||""==b)b=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];else if(b.length<30)for(var e=b.length;30>e;e++)b[e]=0;for(var e=0;3>e;e++)for(var f=0;10>f;f++)TL2CALC.setPoint(e,f,d(b[10*e+f]));TL2CALC.Mailman.unsubscribe("skillsetLoaded",this,c),TL2CALC.Mailman.subscribe("playerChange",this,g)},d=function(a){return a=parseInt(a,16),isNaN(a)?0:a},e=function(a){return a=parseInt(a,10),isNaN(a)?0:a.toString(16)},f=function(){for(var a="",b=0;30>b;b++)a+=e(TL2CALC.getPoint(Math.floor(b/10),b-10*Math.floor(b/10)));return a},g=function(){var a=[location.protocol,"//",location.host,location.pathname].join("");a+="?class="+TL2CALC.getPlayer()+"&points="+f(),history.replaceState({calc:"points"},"TL2 Calculator Saved Build",a),TL2CALC.Mailman.publish("linkChange",a)};TL2CALC.Mailman.subscribe("uiReady",this,b),TL2CALC.Mailman.subscribe("pointChange",this,g)}(),TL2CALC.UI={},TL2CALC.UI.Player=function(a){var b=function(){var b=a.getAttribute("data-player");TL2CALC.Mailman.publish("playerChange",b)},c=function(b){var c=a.getAttribute("data-player");c==b?a.className.match(new RegExp("(?:^|\\s)active(?!\\S)","g"))||(a.className+=" active"):a.className=a.className.replace(new RegExp("(?:^|\\s)active(?!\\S)","g"),"")};TL2CALC.Mailman.subscribe("playerChange",this,c),a.addEventListener("click",b)},TL2CALC.UI.Tab=function(a,b){var c=function(){TL2CALC.Mailman.publish("treeChange",b)},d=function(c){a.getElementsByClassName("name")[0].innerHTML=c.skillset.tree[b].name},e=function(c){b==c?a.className.match(new RegExp("(?:^|\\s)active(?!\\S)","g"))||(a.className+=" active"):a.className=a.className.replace(new RegExp("(?:^|\\s)active(?!\\S)","g"),"")};TL2CALC.Mailman.subscribe("treeChange",this,e),TL2CALC.Mailman.subscribe("skillsetLoaded",this,d),a.addEventListener("click",c)},TL2CALC.UI.Point=function(a,b){var c=function(c){b==c&&(a.innerHTML=TL2CALC.getPointsInTree(c))};TL2CALC.Mailman.subscribe("pointChange",this,c)},TL2CALC.UI.Tree=function(a,b){var c=function(c){b==c?a.className.match(new RegExp("(?:^|\\s)active(?!\\S)","g"))||(a.className+=" active"):a.className=a.className.replace(new RegExp("(?:^|\\s)active(?!\\S)","g"),"")};TL2CALC.Mailman.subscribe("treeChange",this,c)},TL2CALC.UI.SkillButton=function(a,b,c){var d=function(){var d=a.getAttribute("data-effect");switch(d){case"clear":TL2CALC.setPoint(b,c,0);break;case"minus":TL2CALC.setPoint(b,c,TL2CALC.getPoint(b,c)-1);break;case"plus":TL2CALC.setPoint(b,c,TL2CALC.getPoint(b,c)+1)}};a.addEventListener("click",d)},TL2CALC.UI.SkillName=function(a,b,c){var d=function(d){a.innerHTML=d.skillset.tree[b].skill[c].name};TL2CALC.Mailman.subscribe("skillsetLoaded",this,d)},TL2CALC.UI.SkillLevel=function(a,b,c){var d=function(d,e,f){b==d&&c==e&&(a.innerHTML=f)};TL2CALC.Mailman.subscribe("pointChange",this,d)},TL2CALC.UI.SkillIcon=function(a,b,c){var d={},e=function(a){d.inactive={xPos:a.skillset.tree[b].skill[c].icons.inactive.xPos,yPos:a.skillset.tree[b].skill[c].icons.inactive.yPos},d.active={xPos:a.skillset.tree[b].skill[c].icons.active.xPos,yPos:a.skillset.tree[b].skill[c].icons.active.yPos},f(b,c,TL2CALC.getPoint(b,c))},f=function(e,f,g){b==e&&c==f&&(g>0?(a.style.backgroundPositionX=-d.active.xPos+"px",a.style.backgroundPositionY=-d.active.yPos+"px"):(a.style.backgroundPositionX=-d.inactive.xPos+"px",a.style.backgroundPositionY=-d.inactive.yPos+"px"))};TL2CALC.Mailman.subscribe("skillsetLoaded",this,e),TL2CALC.Mailman.subscribe("pointChange",this,f)},TL2CALC.UI.ShareLink=function(a){var b=function(b){a.innerHTML=b};TL2CALC.Mailman.subscribe("linkChange",this,b)},window.onload=function(){for(var a,b=[],c=[],d=[],e=[],f=[],g=[],h=[],i=[],j=document.getElementsByClassName("player"),k=0,l=j.length;l>k;k++)b[k]=new TL2CALC.UI.Player(j[k]);for(var m=document.getElementsByClassName("tab"),k=0,l=m.length;l>k;k++)h[k]=new TL2CALC.UI.Tab(m[k],k),g[k]=new TL2CALC.UI.Point(m[k].getElementsByClassName("point")[0],k);for(var n=document.getElementsByClassName("tree"),k=0,l=n.length;l>k;k++){i[k]=new TL2CALC.UI.Tree(n[k],k);var o=n[k].getElementsByClassName("skill");c[k]=[],e[k]=[],d[k]=[],f[k]=[];for(var p=0,q=o.length;q>p;p++){e[k][p]=new TL2CALC.UI.SkillName(o[p].getElementsByClassName("skill-name")[0],k,p),d[k][p]=new TL2CALC.UI.SkillIcon(o[p].getElementsByClassName("skill-icon")[0],k,p),f[k][p]=new TL2CALC.UI.SkillLevel(o[p].getElementsByClassName("skill-level")[0],k,p);var r=o[p].getElementsByClassName("skill-button");c[k][p]=[];for(var s=0,t=r.length;t>s;s++)c[k][p][s]=new TL2CALC.UI.SkillButton(r[s],k,p)}}a=new TL2CALC.UI.ShareLink(document.getElementById("share-link")),TL2CALC.Mailman.publish("uiReady")};